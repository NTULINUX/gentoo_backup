#
# Global portage options
#

# SMT enabled on 8-core/16-thread processor
# Compile with 16 threads, and 2 jobs at once (16 * 2 = 32)
# emerge tends to only run one job at a time so double it
MAKEOPTS="-j16"
EMERGE_PARALLEL_OPTS="-j2"

USE_GLOBAL_DISABLE="-alsa -backlight -binutils-plugin -cet -chatzilla -classic -colord -concheck -cramfs -cron -daemon -debug -default-stack-clash-protection -default-znow -deprecated -dhclient -dhcp -dhcpcd -dht -doc -drop-root -dvbpsi -elf -geoip -geoloc -geolocation -gmp-autoupdate -gnome -gold -gtk-doc -handbook -hardened -hardlink -http -imap -initramfs -interlaced -iptables -ipv6 -iwd -libproxy -lock -man -mpris -mtp -mysql -nullok -perl -pic -pie -pkcs7 -plucker -pop3 -ppp -samba -savedconfig -secure-delete -server -smartcard -smi -smtp -ssh-agent -sslv2 -sslv3 -ssp -static-pie -statusnotifier -sudo -suid -systemd -telemetry -tftp -tls-heartbeat -tofu -touchpad -vlc -webkit -wext -wifi -xscreensaver"

# Disable codecs and such (avoid possible licensing issues)
USE_MULTIMEDIA="-a52 -aac -dav1d -dts -mad -matroska -mp3 -mpeg -openh264 -proprietary-codecs -x264 -x265 -xvid"

# Final USE flags for production environment
USE="${USE_GLOBAL_DISABLE} ${USE_MULTIMEDIA} X acl admin appindicator apng bindist branding caps clang compiler-rt cpudetection cups custom-cflags custom-optimization dbus default-compiler-rt default-libcxx default-lld drm egl elogind encode ffmpeg fftw filecaps flac gbm gles1 gles2 gtk hwaccel hwloc icu imagemagick int-quality introspection iproute2 jit kf6compat libass libcxx libcxxabi libdrm libnotify libsamplerate libunwind llvm-libunwind lto lximage ncurses network offensive ogg opengl openmp opus pam pgo pipewire pipewire-alsa policykit postproc ppds pulseaudio python qt6 qml rubberband sanitize smp sound-server system-harfbuzz system-icu system-jpeg system-libevent system-libvpx system-llvm system-png system-sqlite system-ssl tcl theora threads tk tray truetype udev udisks upower v4l vaapi vala vdpau vorbis vpx vulkan wayland xattr xcb xfce xinerama xv xvfb"

# X86-specific CPU instructions (x86-64-v3 psABI)
# pclmul is not included in x86-64-v3 psABI however this is usually detected at run-time anyway
CPU_FLAGS_X86="avx avx2 f16c fma3 mmx mmxext pclmul popcnt sse sse2 sse3 ssse3 sse4_1 sse4_2"

# LLVM and X.org drivers
INPUT_DEVICES="evdev"
LLVM_TARGETS="AMDGPU NVPTX"
VIDEO_CARDS="amdgpu intel nouveau r600 radeon radeonsi"

# Exclude FFmpeg tools
FFTOOLS=""

GENTOO_MIRRORS="https://gentoo.osuosl.org/"

L10N="en en-CA en-GB en-US"

#
# DO NOT MODIFY BELOW THIS LINE
#

# glibc
CHOST="x86_64-pc-linux-gnu"

LC_MESSAGES=C

PORTDIR="/var/db/repos/gentoo"
DISTDIR="/var/cache/distfiles"
PKGDIR="/var/cache/binpkgs"

# Mask stupid/useless SystemD service files
MASK_SYSTEMD_FILES="/lib/systemd/*.service /lib/systemd/*/*.service /usr/lib/systemd/*.service /usr/lib/systemd/*/*.service"
# Mask stupid/broken X.org session files for display manager
MASK_XSESSION_FILES="/usr/share/xsessions/Xsession.desktop"
INSTALL_MASK="${INSTALL_MASK} ${MASK_SYSTEMD_FILES} ${MASK_XSESSION_FILES}"

# Allow packages marked unstable
ACCEPT_KEYWORDS="~amd64"

# Always include build dependencies, respect parallel job options
EMERGE_DEFAULT_OPTS="--with-bdeps=y ${EMERGE_PARALLEL_OPTS}"

# Use entire LLVM toolchain by default
CC="clang"
CXX="clang++"
LD="ld.lld"
AR="llvm-ar"
AS="clang"
NM="llvm-nm"
OBJCOPY="llvm-objcopy"
OBJDUMP="llvm-objdump"
RANLIB="llvm-ranlib"
READELF="llvm-readelf"
READOBJ="llvm-readobj"
STRIP="llvm-strip"

# Global compiler/linker flags
TRIM_SEC_FLAGS="-fno-stack-protector -fno-stack-clash-protection -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=0"
#COMMON_FLAGS="-O3 -march=x86-64-v3 -fomit-frame-pointer -flto -fwhole-program ${TRIM_SEC_FLAGS} -pipe"
COMMON_FLAGS="-O3 -march=x86-64-v3 -fomit-frame-pointer -flto=thin ${TRIM_SEC_FLAGS} -pipe"
CFLAGS="${COMMON_FLAGS}"
CXXFLAGS="${COMMON_FLAGS}"
#LDFLAGS="${LDFLAGS} ${COMMON_FLAGS} -fuse-ld=bfd -Wl,-z,lazy -Wl,--strip-all"
LDFLAGS="${LDFLAGS} ${COMMON_FLAGS} -fuse-ld=lld -Wl,-z,lazy -Wl,--strip-all"

# Initial USE flags for bootstrapping
# USE="${USE_GLOBAL_DISABLE} ${USE_MULTIMEDIA} bindist caps clang compiler-rt custom-cflags custom-optimization default-compiler-rt default-libcxx default-lld filecaps hwloc jit libcxx libcxxabi libunwind llvm-libunwind lto nss pam pgo sanitize smp threads xattr"

LUA_TARGETS="lua5-4"
LUA_SINGLE_TARGET="lua5-4"

PYTHON_TARGETS="python3_12"
PYTHON_SINGLE_TARGET="python3_12"

RUBY_TARGETS="ruby33"

# Support both UEFI and legacy installations of GRUB
GRUB_PLATFORMS="efi-64 pc"
