#
# Global portage options
#

# SMT enabled on Ryzen 2700X, modify as needed
MAKEOPTS="-j16"

# Final USE flags for production environment
USE="-about -alsa -automount -backlight -bindist -binutils-plugin -chatzilla -classic -colord -concheck -cramfs -cron -daemon -debug -deprecated -dhclient -dhcp -dhcpcd -dht -directorymenu -doc -drop-root -dvbpsi -elf -fortran -geoip -geoloc -geolocation -gles2 -gmp-autoupdate -gnome -gold -gtk-doc -handbook -hardlink -http -iconv -imap -interlaced -iptables -ipv6 -jit -jpeg2k -kbindicator -kde -kdesu -kwallet -libffi -libkms -libproxy -libtommath -luajit -magic -man -minizip -modemmanager -mount -mpris -mtp -mysql -nullok -openssl -pcre -pcre-jit -perl -plucker -pop3 -ppp -pulseaudio -samba -screenshot -sddm -server -smartcard -smi -smtp -sound -sqlite -ssh-agent -sslv2 -sslv3 -suid -systemd -telemetry -tftp -tls-heartbeat -tofu -touchpad -trash -trash-panel-plugin -uchardet -udisks -upower -vala -vlc -volume -webkit -wext -wifi -zstd X a52 acl appindicator apng branding caps cdda clang compiler-rt cpudetection cups custom-cflags custom-optimization dav1d dbus default-compiler-rt default-libcxx default-lld drm dts dvd egl elogind encode ffmpeg fftw filecaps flac gbm gles1 gles2 hardened harfbuzz hwaccel hwloc icu introspection iproute2 jack libass libcxx libcxxabi libsamplerate libunwind llvm-libunwind lto matroska mp3 mpeg ncurses nettle network nss offload offensive ogg opengl openmp opus pam pgo pic pie pkcs7 policykit postproc ppds python rubberband savedconfig secure-delete smp static-pie system-bootstrap system-harfbuzz system-icu system-jpeg system-libevent system-libvpx system-llvm system-png system-sqlite system-ssl tcl theora threads tk truetype udev vaapi vdpau verify-sig vpx vorbis vulkan x264 x265 xattr xcb xinerama xv xvfb xvid"

# X86-specific CPU instructions
CPU_FLAGS_X86="aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt sse sse2 sse3 ssse3 sse4_1 sse4_2"

# LLVM and X.org drivers
INPUT_DEVICES="evdev"
LLVM_TARGETS="AMDGPU"
VIDEO_CARDS="amdgpu"

# Exclude FFmpeg tools
FFTOOLS=""

GENTOO_MIRRORS="https://gentoo.osuosl.org/"

#
# DO NOT MODIFY BELOW THIS LINE
#

# glibc
CHOST="x86_64-pc-linux-gnu"

LC_MESSAGES=C
L10N="en en-US"

PORTDIR="/var/db/repos/gentoo"
DISTDIR="/var/cache/distfiles"
PKGDIR="/var/cache/binpkgs"

# Allow packages marked unstable
ACCEPT_KEYWORDS="~amd64"

# Always include build dependencies
EMERGE_DEFAULT_OPTS="--with-bdeps=y"

# Use entire LLVM toolchain by default
CC="clang"
CXX="clang++"
LD="ld.lld"
AR="llvm-ar"
AS="clang"
NM="llvm-nm"
OBJCOPY="llvm-objcopy"
OBJDUMP="llvm-objdump"
RANLIB="llvm-ranlib"
READELF="llvm-readelf"
READOBJ="llvm-readobj"
STRIP="llvm-strip"

# Harden entire system
COMMON_FLAGS="-O2 -fPIC -fstack-protector-strong -fstack-clash-protection -fomit-frame-pointer -pipe -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=2"
CFLAGS="${COMMON_FLAGS}"
CXXFLAGS="${COMMON_FLAGS}"
LDFLAGS="${LDFLAGS} ${COMMON_FLAGS} -fuse-ld=lld -Wl,-z,now -Wl,-z,relro -Wl,--strip-debug"

# Initial USE flags for bootstrapping
# USE="-about -alsa -automount -backlight -bindist -binutils-plugin -chatzilla -classic -colord -concheck -cramfs -cron -daemon -debug -deprecated -dhclient -dhcp -dhcpcd -dht -directorymenu -doc -drop-root -dvbpsi -elf -fortran -geoip -geoloc -geolocation -gles2 -gmp-autoupdate -gnome -gold -gtk-doc -handbook -hardlink -http -iconv -imap -interlaced -iptables -ipv6 -jit -jpeg2k -kbindicator -kde -kdesu -kwallet -libffi -libkms -libproxy -libtommath -luajit -magic -man -minizip -modemmanager -mount -mpris -mtp -mysql -nullok -openssl -pcre -pcre-jit -perl -plucker -pop3 -ppp -pulseaudio -samba -screenshot -sddm -server -smartcard -smi -smtp -sound -sqlite -ssh-agent -sslv2 -sslv3 -suid -systemd -telemetry -tftp -tls-heartbeat -tofu -touchpad -trash -trash-panel-plugin -uchardet -udisks -upower -vala -vlc -volume -webkit -wext -wifi -zstd caps clang compiler-rt custom-cflags custom-optimization default-compiler-rt default-libcxx default-lld filecaps hardened hwloc libcxx libcxxabi libunwind llvm-libunwind lto nss offload pam pgo pic pie pkcs7 smp static-pie threads verify-sig xattr"

# SECURITY: Always prefer NSS over OpenSSL
CURL_SSL="nss"

# SECURITY: DO NOT USE JIT
# Newer versions of Lua are problematic at this time
LUA_TARGETS="lua5-1"
LUA_SINGLE_TARGET="lua5-1"

# Use Python 3.10 until newer versions become fully stabilized
PYTHON_TARGETS="python3_10"
PYTHON_SINGLE_TARGET="python3_10"

# Support both UEFI and legacy installations of GRUB
GRUB_PLATFORMS="efi-64 pc"
