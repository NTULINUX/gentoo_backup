#
# Global portage options
#

# SMT enabled on 8-core/16-thread processor, modify with care
# Compile with 16 threads, 1 job at a time
MAKEOPTS="-j16"
EMERGE_PARALLEL_OPTS="-j1"

# Final USE flags for production environment
USE="-a52 -aac -alsa -automount -backlight -binutils-plugin -bluray -cdda -cdio -chatzilla -classic -colord -cramfs -cron -cups -daemon -dav1d -debug -default-stack-clash-protection -default-znow -deprecated -desktop-portal -dht -directorymenu -doc -drm -drop-root -dts -dvbpsi -dvd -dvdnav -elf -encode -ffmpeg -flac -fortran -geoip -geoloc -geolocation -gles1 -gles2 -gmp-autoupdate -gnome -gold -gstreamer -gtk-doc -handbook -hangouts -hardened -hardlink -http -imap -int-quality -interlaced -iptables -iwd -jack -jpeg2k -js-type-check -kbindicator -kde -kdesu -kwallet -libass -libproxy -libsamplerate -libtommath -man -matroska -modemmanager -mount -mp3 -mpeg -mpris -mtp -mysql -ogg -openh264 -opus -passwdqc -pcre -perl -pic -pie -plucker -pop3 -postproc -ppds -ppp -proprietary-codecs -pulseaudio -rdoc -rubberband -samba -sanitize -savedconfig -screencast -screenshot -secure-delete -sendmail -server -smartcard -smi -smtp -sound -ssh-agent -sslv2 -sslv3 -ssp -static-analyzer -static-pie -suid -system-av1 -system-libvpx -system-webm -systemd -telemetry -tftp -theora -thunar -tls-heartbeat -tofu -touchpad -trash -trash-panel-plugin -udisks -upower -vaapi -vala -vdpau -verify-sig -vlc -volume -vorbis -vpx -vulkan -webkit -wext -widevine -x264 -x265 -xscreensaver -xv -xvid -zstd X appindicator bindist branding clang compiler-rt compress-xz cpudetection custom-cflags custom-optimization dbus default-compiler-rt default-libcxx default-lld dynamic-loading elogind eme-free graphicsmagick gbm hwloc icu imagemagick introspection jit largepages64k lazy-lock libcxx libcxxabi llvm-libunwind lto lximage opengl openmp pam pgo policykit python smp system-bootstrap system-llvm tcl tcmalloc threads tk tray truetype udev v4l wifi xinerama xmalloc xv xvfb"

# LLVM and X.org drivers
INPUT_DEVICES="evdev"
LLVM_TARGETS="AMDGPU NVPTX"
VIDEO_CARDS="amdgpu intel nouveau r600 radeon radeonsi"

# Exclude FFmpeg tools
FFTOOLS=""

GENTOO_MIRRORS="https://gentoo.osuosl.org/"

L10N="en en-CA en-GB en-US"

#
# DO NOT MODIFY BELOW THIS LINE
#

# glibc
CHOST="x86_64-pc-linux-gnu"

LC_MESSAGES=C

PORTDIR="/var/db/repos/gentoo"
DISTDIR="/var/cache/distfiles"
PKGDIR="/var/cache/binpkgs"

# Mask stupid/useless SystemD service files
MASK_SYSTEMD_FILES="/lib/systemd/*.service /lib/systemd/*/*.service /usr/lib/systemd/*.service /usr/lib/systemd/*/*.service"
# Mask stupid/broken X.org session files for display manager
MASK_XSESSION_FILES="/usr/share/xsessions/Xsession.desktop /usr/share/xsessions/openbox*.desktop"
INSTALL_MASK="${MASK_SYSTEMD_FILES} ${MASK_XSESSION_FILES}"

# Allow packages marked unstable
ACCEPT_KEYWORDS="~amd64"

# Always include build dependencies, respect parallel job options
EMERGE_DEFAULT_OPTS="--with-bdeps=y ${EMERGE_PARALLEL_OPTS}"

# Use entire LLVM toolchain by default
CC="clang"
CXX="clang++"
LD="ld.lld"
AR="llvm-ar"
AS="clang"
NM="llvm-nm"
OBJCOPY="llvm-objcopy"
OBJDUMP="llvm-objdump"
RANLIB="llvm-ranlib"
READELF="llvm-readelf"
READOBJ="llvm-readobj"
STRIP="llvm-strip"

# X86-specific CPU instructions (x86-64-v2 psABI)
CPU_FLAGS_X86="mmx mmxext popcnt sse sse2 sse3 ssse3 sse4_1 sse4_2"

# Global compiler/linker flags
TRIM_SIZE_FLAGS="-ffunction-sections -fdata-sections"
TRIM_SEC_FLAGS="-fno-stack-protector -fno-stack-clash-protection -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=0"
TRIM_SIZE_LDFLAGS="-Wl,--gc-sections -Wl,--sort-section,alignment -Wl,--sort-common"
COMMON_FLAGS="-O2 -march=x86-64-v2 -fomit-frame-pointer ${TRIM_SIZE_FLAGS} ${TRIM_SEC_FLAGS} -pipe"
CFLAGS="${COMMON_FLAGS}"
CXXFLAGS="${COMMON_FLAGS}"
LDFLAGS="${LDFLAGS} -fuse-ld=lld ${COMMON_FLAGS} ${TRIM_SIZE_LDFLAGS} -Wl,-z,lazy -Wl,--strip-all"

# Initial USE flags for bootstraping
# USE="-a52 -aac -alsa -automount -backlight -binutils-plugin -bluray -cdda -cdio -chatzilla -classic -colord -cramfs -cron -cups -daemon -dav1d -debug -default-stack-clash-protection -default-znow -deprecated -desktop-portal -dht -directorymenu -doc -drm -drop-root -dts -dvbpsi -dvd -dvdnav -elf -encode -ffmpeg -flac -fortran -geoip -geoloc -geolocation -gles1 -gles2 -gmp-autoupdate -gnome -gold -gstreamer -gtk-doc -handbook -hangouts -hardened -hardlink -http -imap -int-quality -interlaced -iptables -iwd -jack -jpeg2k -js-type-check -kbindicator -kde -kdesu -kwallet -libass -libproxy -libsamplerate -libtommath -man -matroska -modemmanager -mount -mp3 -mpeg -mpris -mtp -mysql -ogg -openh264 -opus -passwdqc -pcre -perl -pic -pie -plucker -pop3 -postproc -ppds -ppp -proprietary-codecs -pulseaudio -rdoc -rubberband -samba -sanitize -savedconfig -screencast -screenshot -secure-delete -sendmail -server -smartcard -smi -smtp -sound -ssh-agent -sslv2 -sslv3 -ssp -static-analyzer -static-pie -suid -system-av1 -system-libvpx -system-webp -system -systemd -telemetry -tftp -theora -thunar -tls-heartbeat -tofu -touchpad -trash -trash-panel-plugin -udisks -upower -vaapi -vala -vdpau -verify-sig -vlc -volume -vorbis -vpx -vulkan -webkit -wext -widevine -x264 -x265 -xscreensaver -xv -xvid -zstd -X bindist branding clang compiler-rt compress cpudetection custom-cflags custom-optimization default-compiler-rt default-libcxx default-lld eme-free hwloc jit libcxx libcxxabi llvm-libunwind lto openmp pam pgo python smp system-bootstrap system-llvm threads udev"

# Use LuaJIT for better performance
LUA_TARGETS="luajit"
LUA_SINGLE_TARGET="luajit"

PYTHON_TARGETS="python3_11"
PYTHON_SINGLE_TARGET="python3_11"

# <dev-lang/ruby-3.1 requires dev-libs/openssl:0/1.1
RUBY_TARGETS="ruby32"

# Support both UEFI and legacy installations of GRUB
GRUB_PLATFORMS="efi-64 pc"
